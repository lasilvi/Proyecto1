{% extends 'base.html' %}
{% block content %}

{% load crispy_forms_tags %}
<!-- Incluir los archivos CSS y JS del selector de fecha y hora -->
<link rel="stylesheet" href="ruta/al/css/bootstrap-datetimepicker.css">
<script src="ruta/al/js/bootstrap-datetimepicker.js"></script>

<div class="container mt-5">
  <div class="row justify-content-center align-items-center">
      <div class="d-flex p-2">
          <form method="post" >
              {% csrf_token %}
              <table class="table text-center ">
                  <tr> 
                    <h1 class="text-center">Sistema de control y registro de actas de reuniones</h1>
                    <h2 class="text-center">Escuela Interamericana de Bibliotecología</h2>
                  <tr> 
                      <td >
                          <label for="{{ form.name.id_for_label }}">Nombre</label>
                          <div>
                              {{ form.name}}
                          </div>
                      </td>
                      <td >
                        <label for="{{ form.cod.id_for_label }}">Codigo</label>
                        <div>
                            {{ form.cod}}
                        </div>
                    </td>
                  </tr> 
              </table>
              <td colspan="3">
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Crear</button>
                </div>
             </td>
             <table class="table text-center">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Codigo</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for data in processs %}
                    <tr>
                      <td>{{ data.name }}</td>
                      <td>{{ data.cod }}</td>
                      <td>
                        <a href="{% url 'EditarProceso' data.id %}" class="btn btn-danger btn-sm">Editar</a>
                        <button class="btn btn-danger btn-sm delete-user" data-user-id="{{ data.id }}">Eliminar</button>
                      </td>
                    </tr>
                  {% empty %}
                    <tr>
                      <td colspan="5">No se encontraron actas.</td>
                    </tr>
                  {% endfor %}
                  
                </tbody>
                <td colspan="3" class="text-center">
                  <a href="{% url 'menu' %}" class="btn btn-primary">Volver a menú</a>
                </td>
              </table>
          </form>
      </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $('.delete-user').click(function() {
    var userId = $(this).data('user-id');

    // Confirmar la eliminación del usuario (opcional)
    if (confirm('¿Estás seguro de que deseas eliminar este usuario?')) {
      // Enviar la solicitud POST al servidor utilizando AJAX
      $.ajax({
        url: '/app_registro/eliminar_usuario/',  // Reemplaza esto con la URL correcta para eliminar el usuario
        type: 'POST',
        data: {
          'user_id': userId
        },
        success: function(response) {
          // Manejar la respuesta del servidor
          // Por ejemplo, actualizar la vista para reflejar la eliminación del usuario
          // Puedes mostrar un mensaje de éxito o actualizar la lista de usuarios, etc.
          console.log('El usuario ha sido eliminado exitosamente');
        },
        error: function(xhr, textStatus, errorThrown) {
          // Manejar errores en caso de que ocurra alguno durante la solicitud
          console.error('Ocurrió un error al eliminar el usuario:', errorThrown);
        }
      });
    }
  });
});
</script>
{% endblock %}
